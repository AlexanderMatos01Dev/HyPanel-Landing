---
import Layout from '../layouts/Layout.astro';
import Navbar from '../components/sections/Navbar';
import BlogIndex from '../components/sections/BlogIndex';
import Footer from '../components/sections/Footer';
import { getCollection } from 'astro:content';
import { getImage } from "astro:assets";
import type { CollectionEntry } from 'astro:content';

// Obtener posts de la colecci√≥n y ordenarlos por ID (descendente)
const rawPosts = (await getCollection('blog')).sort(
	(a: CollectionEntry<'blog'>, b: CollectionEntry<'blog'>) => (b.data.id || 0) - (a.data.id || 0)
);

// Optimize images for the React component
const posts = await Promise.all(rawPosts.map(async (post) => {
  if (post.data.image) {
    const optimized = await getImage({
      src: post.data.image,
      format: 'webp',
      width: 1200,
      quality: 80
    });
    return {
      ...post,
      data: {
        ...post.data,
        image: optimized.src
      }
    };
  }
  return post;
}));

// SEO Configuration for Blog Index
const seoTitle = "Blog - HyPanel | News, Tutorials & Updates";
const seoDescription = "Stay up to date with the latest HyPanel news, development updates, tutorials, and community spotlights. Learn how to build and manage Hytale servers.";
const canonicalUrl = "https://hypanel.net/blog";
---

<Layout 
	title={seoTitle} 
	description={seoDescription}
	canonical={canonicalUrl}
>
	<div class="min-h-screen bg-[#0B0F19] text-white overflow-x-hidden">
		<!-- Fixed decorative background -->
		<div class="fixed inset-0 pointer-events-none" style="z-index: -1;">
			<div class="absolute top-0 left-0 w-full h-[600px] bg-gradient-to-b from-[#151D2C]/80 via-[#0B0F19] to-[#0B0F19]"></div>
			<div class="absolute inset-0 bg-[linear-gradient(to_right,#8080800a_1px,transparent_1px),linear-gradient(to_bottom,#8080800a_1px,transparent_1px)] bg-[size:40px_40px] opacity-50"></div>
			<div class="absolute top-20 right-0 w-[500px] h-[500px] bg-[#4DA6FF]/5 rounded-full blur-[100px]"></div>
			<div class="absolute bottom-0 left-0 w-[500px] h-[500px] bg-[#EDA333]/5 rounded-full blur-[100px]"></div>
		</div>

		<!-- Main content -->
		<div class="relative z-10">
			<Navbar client:visible />
			<BlogIndex client:load posts={posts} />
			<Footer />
		</div>
	</div>
</Layout>
