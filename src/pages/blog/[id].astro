---
import Layout from "../../layouts/Layout.astro";
import Navbar from "../../components/sections/Navbar";
import Footer from "../../components/sections/Footer";
import { Image } from "astro:assets";
import {
  Clock,
  Link as LinkIcon,
  Facebook,
  ArrowLeft,
  ArrowRight,
} from "lucide-react";
import { getCollection, render } from "astro:content";
import type { CollectionEntry } from "astro:content";

export async function getStaticPaths() {
  const posts = await getCollection("blog");
  return posts.map((post: CollectionEntry<"blog">) => ({
    params: { id: post.slug },
    props: { post },
  }));
}

interface Props {
  post: CollectionEntry<"blog">;
}

const { post } = Astro.props;
const { Content, headings } = await render(post);

const tocHeadings = headings.filter(h => h.depth === 2 || h.depth === 3);

const allPosts = await getCollection("blog");
let relatedPosts: CollectionEntry<"blog">[] = [];

if (post.data.relatedPosts && post.data.relatedPosts.length > 0) {
  const relatedSlugs = post.data.relatedPosts;
  relatedPosts = relatedSlugs
    .map(slug => allPosts.find(p => p.slug === slug))
    .filter((p): p is CollectionEntry<"blog"> => p !== undefined)
    .slice(0, 3);
} else {
  relatedPosts = allPosts
    .filter(p => p.slug !== post.slug)
    .filter(p => p.data.category === post.data.category || p.data.featured)
    .sort((a, b) => b.data.date.getTime() - a.data.date.getTime())
    .slice(0, 3);
}
---

<Layout
  title={`${post.data.title} - HyPanel Blog`}
  description={post.data.excerpt}
>
  <div
    class="min-h-screen bg-[#0B0F19] text-[#E0E6ED] font-sans selection:bg-[#EDA333] selection:text-[#0B0F19] relative"
  >
    <!-- Reading Progress Bar -->
    <div 
      id="reading-progress" 
      class="fixed top-0 left-0 h-1 bg-gradient-to-r from-[#4DA6FF] via-[#EDA333] to-[#4DA6FF] z-[100] transition-all duration-150"
      style="width: 0%"
    ></div>

    <!-- Navbar -->
    <div class="relative z-50">
      <Navbar client:visible />
    </div>

    <!-- Background Elements - z-index -1 to stay behind everything -->
    <div class="fixed inset-0 pointer-events-none -z-10">
      <div
        class="absolute top-0 left-0 w-full h-[600px] bg-gradient-to-b from-[#151D2C] via-[#0B0F19] to-transparent"
      >
      </div>
      <div
        class="absolute inset-0 bg-[linear-gradient(to_right,#8080800a_1px,transparent_1px),linear-gradient(to_bottom,#8080800a_1px,transparent_1px)] bg-[size:40px_40px] opacity-20"
      >
      </div>
    </div>

    <main class="relative z-10 pt-24 pb-24">
      <!-- Back to Blog Link -->
      <div class="max-w-[1400px] mx-auto px-6 mb-8">
        <a 
          href="/blog" 
          class="inline-flex items-center gap-2 text-[#8B9BB4] hover:text-[#EDA333] transition-colors text-sm group"
        >
          <ArrowLeft size={16} className="group-hover:-translate-x-1 transition-transform" />
          <span>Back to all articles</span>
        </a>
      </div>



      <!-- Main Grid Layout -->
      <div
        class="max-w-[1400px] mx-auto px-6 grid grid-cols-1 lg:grid-cols-12 gap-8 lg:gap-12"
      >
        <!-- Left Sidebar (Share) - Hidden on mobile, sticky on desktop -->
        <div class="hidden lg:block lg:col-span-1 h-full">
          <div class="h-[calc(100%-150px)] relative">
            <div class="flex flex-col gap-3 items-center pt-4">
            <span
              class="text-[10px] font-bold text-[#8B9BB4] uppercase tracking-wider mb-2"
              style="writing-mode: vertical-lr; transform: rotate(180deg);"
              >Share</span
            >
            <div class="w-px h-6 bg-[#2A3B4C]"></div>
            <button
              id="share-twitter"
              class="p-2.5 rounded-xl bg-[#151D2C]/50 border border-[#2A3B4C] text-[#8B9BB4] hover:text-[#1DA1F2] hover:border-[#1DA1F2]/50 hover:bg-[#1DA1F2]/10 transition-all group"
              title="Share on Twitter"
            >
              <svg
                width="18"
                height="18"
                viewBox="0 0 24 24"
                fill="currentColor"
                class="group-hover:scale-110 transition-transform"
              >
                <path
                  d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"
                ></path>
              </svg>
            </button>
            <button
              id="share-facebook"
              class="p-2.5 rounded-xl bg-[#151D2C]/50 border border-[#2A3B4C] text-[#8B9BB4] hover:text-[#1877F2] hover:border-[#1877F2]/50 hover:bg-[#1877F2]/10 transition-all group"
              title="Share on Facebook"
            >
              <Facebook
                size={18}
                className="group-hover:scale-110 transition-transform"
              />
            </button>
            <button
              id="share-discord"
              class="p-2.5 rounded-xl bg-[#151D2C]/50 border border-[#2A3B4C] text-[#8B9BB4] hover:text-[#5865F2] hover:border-[#5865F2]/50 hover:bg-[#5865F2]/10 transition-all group"
              title="Share on Discord"
            >
              <svg
                width="18"
                height="18"
                viewBox="0 0 24 24"
                fill="currentColor"
                class="group-hover:scale-110 transition-transform"
              >
                <path d="M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515a.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0a12.64 12.64 0 0 0-.617-1.25a.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 0 0 .031.057a19.9 19.9 0 0 0 5.993 3.03a.078.078 0 0 0 .084-.028a14.09 14.09 0 0 0 1.226-1.994a.076.076 0 0 0-.041-.106a13.107 13.107 0 0 1-1.872-.892a.077.077 0 0 1-.008-.128a10.2 10.2 0 0 0 .372-.292a.074.074 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.12.098.246.198.373.292a.077.077 0 0 1-.006.127a12.299 12.299 0 0 1-1.873.892a.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028a19.839 19.839 0 0 0 6.002-3.03a.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 0 0-.031-.03zM8.02 15.33c-1.183 0-2.157-1.085-2.157-2.419c0-1.333.956-2.419 2.157-2.419c1.21 0 2.176 1.096 2.157 2.42c0 1.333-.956 2.418-2.157 2.418zm7.975 0c-1.183 0-2.157-1.085-2.157-2.419c0-1.333.955-2.419 2.157-2.419c1.21 0 2.176 1.096 2.157 2.42c0 1.333-.946 2.418-2.157 2.418z"/>
              </svg>
            </button>
            <button
              id="share-whatsapp"
              class="p-2.5 rounded-xl bg-[#151D2C]/50 border border-[#2A3B4C] text-[#8B9BB4] hover:text-[#25D366] hover:border-[#25D366]/50 hover:bg-[#25D366]/10 transition-all group"
              title="Share on WhatsApp"
            >
              <svg
                width="18"
                height="18"
                viewBox="0 0 24 24"
                fill="currentColor"
                class="group-hover:scale-110 transition-transform"
              >
                <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"/>
              </svg>
            </button>
            <div class="w-px h-6 bg-[#2A3B4C]"></div>
            <button
              id="copy-link"
              class="p-2.5 rounded-xl bg-[#151D2C]/50 border border-[#2A3B4C] text-[#8B9BB4] hover:text-[#EDA333] hover:border-[#EDA333]/50 hover:bg-[#EDA333]/10 transition-all group"
              title="Copy Link"
            >
              <LinkIcon
                size={18}
                className="group-hover:scale-110 transition-transform"
              />
            </button>
          </div>
          </div>
        </div>

        <!-- Center Content -->
        <div class="lg:col-span-8">
          <!-- Article Header -->
          <div class="mb-8">
            <div class="flex items-center gap-3 mb-4 text-sm flex-wrap">
              <span class="text-[#EDA333] font-bold uppercase tracking-wider">
                {post.data.category}
              </span>
              <span class="text-[#2A3B4C]">•</span>
              <span class="text-[#8B9BB4]">
                {
                  post.data.date.toLocaleDateString("en-US", {
                    month: "long",
                    day: "numeric",
                    year: "numeric",
                  })
                }
              </span>
              <span class="text-[#2A3B4C]">•</span>
              <span class="text-[#8B9BB4]">{post.data.readTime} read</span>
            </div>

            <h1 class="text-3xl sm:text-4xl md:text-5xl font-bold text-white leading-tight mb-6">
              {post.data.title}
            </h1>

            <p class="text-lg sm:text-xl text-[#8B9BB4] leading-relaxed mb-8">
              {post.data.excerpt}
            </p>

            <!-- Author inline for mobile, hidden on desktop -->
            <div class="flex items-center gap-3 lg:hidden mb-8">
              <div class="relative shrink-0">
                <div class="absolute inset-0 bg-gradient-to-br from-[#4DA6FF] to-[#EDA333] rounded-full blur-[2px] opacity-70"></div>
                <img
                  src={post.data.authorImage || "https://api.dicebear.com/7.x/avataaars/svg?seed=hypanel"}
                  alt={post.data.author || "HyPanel Team"}
                  class="relative w-10 h-10 rounded-full border border-[#151D2C] object-cover"
                />
              </div>
              <div class="text-left">
                <div class="text-white font-medium text-sm">
                  {post.data.author || "HyPanel Team"}
                </div>
                <div class="text-[#8B9BB4] text-xs">
                  {post.data.authorRole || "The Team"}
                </div>
              </div>
            </div>
          </div>
          <!-- Featured Image -->
          <div
            class="relative w-full aspect-[21/9] rounded-2xl overflow-hidden mb-10 shadow-2xl shadow-black/50 border border-[#2A3B4C]"
          >
            {post.data.image ? (
              <Image 
                src={post.data.image} 
                alt={post.data.title} 
                class="w-full h-full object-cover"
                width={2400}
                height={1029}
                format="png"
              />
            ) : (
              <>
                <div
                  class={`absolute inset-0 bg-gradient-to-br ${post.data.gradient} opacity-90`}
                >
                  <div
                    class="absolute inset-0 opacity-20 bg-[url('https://grainy-gradients.vercel.app/noise.svg')]"
                  >
                  </div>
                </div>
                <div class="absolute inset-0 flex items-center justify-center">
                  <div class="text-center">
                    <div class="w-20 h-20 rounded-2xl bg-white/10 backdrop-blur-sm border border-white/20 flex items-center justify-center mb-4 mx-auto">
                      <svg
                        class="w-10 h-10 text-white/80"
                        viewBox="0 0 24 24"
                        fill="currentColor"
                      >
                        <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"></path>
                      </svg>
                    </div>
                    <span class="text-white/60 text-sm font-medium uppercase tracking-wider">HyPanel Blog</span>
                  </div>
                </div>
              </>
            )}
          </div>

          <!-- Article Body -->
          <article id="article-content" class="prose prose-invert prose-lg max-w-none w-full">
            <Content />
          </article>

          <!-- Article Footer CTA moved below grid -->



          </div>

        <!-- Right Sidebar (Author & TOC) -->
        <div class="lg:col-span-3 h-full">
          
            <!-- Author Card -->
            <div
              class="p-5 rounded-2xl bg-gradient-to-br from-[#151D2C]/60 to-[#0F1623]/60 border border-[#2A3B4C] backdrop-blur-sm mb-6"
            >
              <span
                class="text-[10px] font-bold text-[#8B9BB4] uppercase tracking-wider mb-4 block"
                >Written by</span
              >
              <div class="flex items-center gap-4">
                <div class="relative shrink-0">
                  <div
                    class="absolute inset-0 bg-gradient-to-br from-[#4DA6FF] to-[#EDA333] rounded-full blur-[3px] opacity-60"
                  >
                  </div>
                  <img
                    src={post.data.authorImage || "https://api.dicebear.com/7.x/avataaars/svg?seed=hypanel"}
                    alt={post.data.author || "HyPanel Team"}
                    class="relative w-12 h-12 rounded-full border-2 border-[#151D2C] object-cover"
                  />
                </div>
                <div>
                  <div class="text-white font-semibold text-sm">
                    {post.data.author || "HyPanel Team"}
                  </div>
                  <div class="text-[#EDA333] text-xs font-medium">
                    {post.data.authorRole || "The Team"}
                  </div>
                </div>
              </div>
            </div>

            <div class="sticky top-28 space-y-6">
            <!-- Table of Contents -->
            {
              tocHeadings.length > 0 && (
                <div id="desktop-toc" class="p-5 rounded-2xl bg-gradient-to-br from-[#151D2C]/60 to-[#0F1623]/60 border border-[#2A3B4C] backdrop-blur-sm hidden lg:block transition-all duration-300">
                  <div class="flex items-center justify-between mb-4">
                    <span class="text-[10px] font-bold text-[#8B9BB4] uppercase tracking-wider">
                      On this page
                    </span>
                    <div class="flex items-center gap-2">
                      <span class="text-[10px] text-[#4DA6FF] font-medium" id="current-section"></span>
                      <button 
                        id="desktop-toc-toggle"
                        class="p-1.5 rounded-lg hover:bg-[#1a2435] text-[#8B9BB4] hover:text-[#EDA333] transition-all"
                        title="Collapse table of contents"
                      >
                        <svg id="toc-collapse-icon" class="w-4 h-4 transition-transform duration-300" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
                        </svg>
                      </button>
                    </div>
                  </div>
                  <nav id="toc-nav" class="flex flex-col gap-1 overflow-hidden transition-all duration-300 max-h-[50vh] overflow-y-auto scrollbar-hide">
                    {tocHeadings.map((heading, index) => (
                      <a
                        href={`#${heading.slug}`}
                        data-heading={heading.slug}
                        class={`toc-link text-sm transition-all duration-200 block py-1.5 px-3 rounded-lg border border-transparent hover:bg-[#1a2435] hover:border-[#2A3B4C] ${
                          heading.depth === 2
                            ? "text-[#8B9BB4] font-medium"
                            : "text-[#6B7A8C] pl-6 text-xs"
                        }`}
                      >
                        <span class="flex items-center gap-2">
                          {heading.depth === 2 && (
                            <span class="w-1.5 h-1.5 rounded-full bg-[#2A3B4C] toc-dot transition-colors"></span>
                          )}
                          <span class="line-clamp-1">{heading.text}</span>
                        </span>
                      </a>
                    ))}
                  </nav>
                </div>
              )
            }


          </div>
          
        </div>
      </div>
    <!-- Footer Grid -->
    <div class="max-w-[1400px] mx-auto px-6">
    <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 lg:gap-12 mt-16">
      <div class="hidden lg:block lg:col-span-1"></div>
      <div class="lg:col-span-8">
          <!-- Article Footer CTA -->
          <div class="p-8 rounded-2xl bg-gradient-to-br from-[#151D2C] to-[#0F1623] border border-[#2A3B4C] relative overflow-hidden">
            <div class="absolute inset-0 bg-[radial-gradient(circle_at_top_right,rgba(77,166,255,0.1),transparent_50%)]"></div>
            <div class="absolute inset-0 bg-[radial-gradient(circle_at_bottom_left,rgba(237,163,51,0.1),transparent_50%)]"></div>
            <div class="relative z-10">
              <h3 class="text-2xl font-bold text-white mb-3">Be part of the journey</h3>
              <p class="text-[#8B9BB4] mb-6 max-w-lg">
                Join our Discord community to discuss this article, share feedback, and shape the future of HyPanel.
              </p>
              <div class="flex flex-wrap gap-4">
                <a 
                  href="https://discord.gg/TrcwkU8x" 
                  target="_blank" 
                  rel="noopener noreferrer"
                  class="inline-flex items-center gap-2 px-6 py-3 rounded-xl bg-[#5865F2] hover:bg-[#4752C4] text-white font-medium transition-colors"
                >
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515a.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0a12.64 12.64 0 0 0-.617-1.25a.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 0 0 .031.057a19.9 19.9 0 0 0 5.993 3.03a.078.078 0 0 0 .084-.028a14.09 14.09 0 0 0 1.226-1.994a.076.076 0 0 0-.041-.106a13.107 13.107 0 0 1-1.872-.892a.077.077 0 0 1-.008-.128a10.2 10.2 0 0 0 .372-.292a.074.074 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.12.098.246.198.373.292a.077.077 0 0 1-.006.127a12.299 12.299 0 0 1-1.873.892a.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028a19.839 19.839 0 0 0 6.002-3.03a.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 0 0-.031-.03zM8.02 15.33c-1.183 0-2.157-1.085-2.157-2.419c0-1.333.956-2.419 2.157-2.419c1.21 0 2.176 1.096 2.157 2.42c0 1.333-.956 2.418-2.157 2.418zm7.975 0c-1.183 0-2.157-1.085-2.157-2.419c0-1.333.955-2.419 2.157-2.419c1.21 0 2.176 1.096 2.157 2.42c0 1.333-.946 2.418-2.157 2.418z"/>
                  </svg>
                  Join Discord
                </a>
                <a 
                  href="/blog" 
                  class="inline-flex items-center gap-2 px-6 py-3 rounded-xl bg-[#151D2C] hover:bg-[#1a2435] border border-[#2A3B4C] text-white font-medium transition-colors"
                >
                  Read more articles
                </a>
              </div>
            </div>
          </div>

          <!-- Related Articles -->
          {relatedPosts.length > 0 && (
            <div class="mt-16">
              <div class="flex items-center justify-between mb-8">
                <h3 class="text-2xl font-bold text-white">Continue reading</h3>
                <a 
                  href="/blog" 
                  class="text-[#EDA333] hover:text-[#f5b94d] text-sm font-medium flex items-center gap-1 group"
                >
                  View all
                  <ArrowRight size={14} className="group-hover:translate-x-1 transition-transform" />
                </a>
              </div>
              <div class="grid gap-6 sm:grid-cols-2 lg:grid-cols-3">
                {relatedPosts.map((relatedPost) => (
                  <a 
                    href={`/blog/${relatedPost.slug}`}
                    class="group block p-5 rounded-2xl bg-gradient-to-br from-[#151D2C]/80 to-[#0F1623]/80 border border-[#2A3B4C] hover:border-[#4DA6FF]/30 transition-all duration-300 hover:-translate-y-1"
                  >
                    <div class="w-full h-32 rounded-xl mb-4 relative overflow-hidden">
                      {relatedPost.data.image ? (
                        <Image 
                          src={relatedPost.data.image} 
                          alt={relatedPost.data.title} 
                          class="w-full h-full object-cover"
                          width={400}
                          height={200}
                        />
                      ) : (
                        <div class={`w-full h-full bg-gradient-to-br ${relatedPost.data.gradient} relative`}>
                          <div class="absolute inset-0 opacity-30 bg-[url('https://grainy-gradients.vercel.app/noise.svg')]"></div>
                          <div class="absolute inset-0 flex items-center justify-center">
                            <div class="w-10 h-10 rounded-lg bg-white/10 backdrop-blur-sm flex items-center justify-center">
                              <svg class="w-5 h-5 text-white/60" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"></path>
                              </svg>
                            </div>
                          </div>
                        </div>
                      )}
                    </div>
                    <span class="text-[10px] font-bold text-[#EDA333] uppercase tracking-wider">{relatedPost.data.category}</span>
                    <h4 class="text-white font-semibold mt-2 mb-2 group-hover:text-[#4DA6FF] transition-colors line-clamp-2">
                      {relatedPost.data.title}
                    </h4>
                    <p class="text-[#8B9BB4] text-sm line-clamp-2 mb-3">{relatedPost.data.excerpt}</p>
                    <div class="flex items-center gap-2 text-[#6B7A8C] text-xs">
                      <Clock size={12} />
                      <span>{relatedPost.data.readTime}</span>
                    </div>
                  </a>
                ))}
              </div>
            </div>
          )}

          <!-- Mobile Share (Visible only on mobile) -->
          <div class="lg:hidden mt-12 pt-8 border-t border-[#2A3B4C]">
            <span
              class="text-sm font-bold text-[#8B9BB4] uppercase tracking-wider mb-4 block"
              >Share this article</span
            >
            <div class="flex gap-3 flex-wrap">
              <button
                class="p-3 rounded-xl bg-[#151D2C]/50 border border-[#2A3B4C] text-[#8B9BB4] hover:text-[#1DA1F2] hover:border-[#1DA1F2]/50 transition-all"
                title="Share on Twitter"
              >
                <svg
                  width="18"
                  height="18"
                  viewBox="0 0 24 24"
                  fill="currentColor"
                >
                  <path
                    d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"
                  ></path>
                </svg></button
              >
              <button
                class="p-3 rounded-xl bg-[#151D2C]/50 border border-[#2A3B4C] text-[#8B9BB4] hover:text-[#1877F2] hover:border-[#1877F2]/50 transition-all"
                title="Share on Facebook"
                ><Facebook size={18} /></button
              >
              <button
                class="p-3 rounded-xl bg-[#151D2C]/50 border border-[#2A3B4C] text-[#8B9BB4] hover:text-[#5865F2] hover:border-[#5865F2]/50 transition-all"
                title="Share on Discord"
              >
                <svg
                  width="18"
                  height="18"
                  viewBox="0 0 24 24"
                  fill="currentColor"
                >
                  <path d="M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515a.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0a12.64 12.64 0 0 0-.617-1.25a.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 0 0 .031.057a19.9 19.9 0 0 0 5.993 3.03a.078.078 0 0 0 .084-.028a14.09 14.09 0 0 0 1.226-1.994a.076.076 0 0 0-.041-.106a13.107 13.107 0 0 1-1.872-.892a.077.077 0 0 1-.008-.128a10.2 10.2 0 0 0 .372-.292a.074.074 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.12.098.246.198.373.292a.077.077 0 0 1-.006.127a12.299 12.299 0 0 1-1.873.892a.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028a19.839 19.839 0 0 0 6.002-3.03a.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 0 0-.031-.03zM8.02 15.33c-1.183 0-2.157-1.085-2.157-2.419c0-1.333.956-2.419 2.157-2.419c1.21 0 2.176 1.096 2.157 2.42c0 1.333-.956 2.418-2.157 2.418zm7.975 0c-1.183 0-2.157-1.085-2.157-2.419c0-1.333.955-2.419 2.157-2.419c1.21 0 2.176 1.096 2.157 2.42c0 1.333-.946 2.418-2.157 2.418z"/>
                </svg>
              </button>
              <button
                class="p-3 rounded-xl bg-[#151D2C]/50 border border-[#2A3B4C] text-[#8B9BB4] hover:text-[#EDA333] hover:border-[#EDA333]/50 transition-all"
                title="Copy Link"
                ><LinkIcon size={18} /></button
              >
            </div>
          </div>
      </div>
    </div>

    </div>
    </main>

    <Footer />
  </div>

  <!-- Mobile TOC Floating Button -->
  {tocHeadings.length > 0 && (
    <div id="mobile-toc-container" class="fixed bottom-6 right-6 z-50 lg:hidden">
      <!-- TOC Panel -->
      <div 
        id="mobile-toc-panel" 
        class="absolute bottom-16 right-0 w-72 max-h-80 overflow-y-auto rounded-2xl bg-gradient-to-br from-[#151D2C]/95 to-[#0F1623]/95 border border-[#2A3B4C] backdrop-blur-xl shadow-2xl shadow-black/50 opacity-0 scale-95 origin-bottom-right pointer-events-none transition-all duration-300 scrollbar-hide"
      >
        <div class="p-4">
          <div class="flex items-center justify-between mb-3">
            <span class="text-xs font-bold text-[#8B9BB4] uppercase tracking-wider">
              On this page
            </span>
            <span class="text-[10px] text-[#4DA6FF] font-medium" id="mobile-current-section"></span>
          </div>
          <nav class="flex flex-col gap-0.5">
            {tocHeadings.map((heading) => (
              <a
                href={`#${heading.slug}`}
                data-heading={heading.slug}
                class={`mobile-toc-link text-sm transition-all duration-200 block py-2 px-3 rounded-lg border border-transparent hover:bg-[#1a2435] hover:border-[#2A3B4C] ${
                  heading.depth === 2
                    ? "text-[#8B9BB4] font-medium"
                    : "text-[#6B7A8C] pl-5 text-xs"
                }`}
              >
                <span class="flex items-center gap-2">
                  {heading.depth === 2 && (
                    <span class="w-1.5 h-1.5 rounded-full bg-[#2A3B4C] mobile-toc-dot transition-colors shrink-0"></span>
                  )}
                  <span class="line-clamp-1">{heading.text}</span>
                </span>
              </a>
            ))}
          </nav>
        </div>
      </div>
      
      <!-- Toggle Button -->
      <button
        id="mobile-toc-toggle"
        class="group flex items-center justify-center w-14 h-14 rounded-full bg-gradient-to-br from-[#EDA333] to-[#d4922e] shadow-lg shadow-[#EDA333]/25 hover:shadow-[#EDA333]/40 transition-all duration-300 hover:scale-105"
        aria-label="Toggle table of contents"
      >
        <svg 
          id="toc-icon-list" 
          class="w-6 h-6 text-[#0B0F19] transition-transform duration-300" 
          fill="none" 
          viewBox="0 0 24 24" 
          stroke="currentColor" 
          stroke-width="2"
        >
          <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h7" />
        </svg>
        <svg 
          id="toc-icon-close" 
          class="w-6 h-6 text-[#0B0F19] absolute opacity-0 scale-75 transition-all duration-300" 
          fill="none" 
          viewBox="0 0 24 24" 
          stroke="currentColor" 
          stroke-width="2"
        >
          <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>
    </div>
  )}
</Layout>

<style is:global>
  /* Scrollbar hide utility */
  .scrollbar-hide {
    -ms-overflow-style: none;
    scrollbar-width: none;
  }
  .scrollbar-hide::-webkit-scrollbar {
    display: none;
  }

  /* Custom Typography Styles */
  .prose {
    max-width: none;
  }

  /* Headings with better spacing - closer to content */
  .prose h2 {
    font-size: 1.75rem;
    margin-top: 2.5rem;
    margin-bottom: 0.875rem;
    color: white;
    font-weight: 700;
    scroll-margin-top: 100px;
    position: relative;
    padding-bottom: 0.5rem;
    border-bottom: 1px solid rgba(42, 59, 76, 0.4);
  }
  
  .prose h2::before {
    content: '';
    position: absolute;
    bottom: -1px;
    left: 0;
    width: 50px;
    height: 2px;
    background: linear-gradient(90deg, #EDA333, transparent);
  }

  .prose h3 {
    font-size: 1.25rem;
    margin-top: 1.75rem;
    margin-bottom: 0.625rem;
    color: #e0e6ed;
    font-weight: 600;
    scroll-margin-top: 100px;
  }

  .prose h4 {
    font-size: 1.0625rem;
    margin-top: 1.5rem;
    margin-bottom: 0.5rem;
    color: #d1d9e3;
    font-weight: 600;
    scroll-margin-top: 100px;
  }

  /* Paragraphs with better readability */
  .prose p {
    margin-bottom: 1.25rem;
    line-height: 1.75;
    color: #a1afc4;
    font-size: 1rem;
    max-width: 70ch; /* Optimal reading width */
  }

  /* First paragraph after heading - no extra space */
  .prose h2 + p,
  .prose h3 + p,
  .prose h4 + p {
    margin-top: 0;
  }

  /* Emphasis and strong */
  .prose strong {
    color: #e0e6ed;
    font-weight: 600;
  }

  .prose em {
    color: #b8c5d3;
    font-style: italic;
  }

  /* Links */
  .prose a {
    color: #eda333;
    text-decoration: none;
    background: linear-gradient(90deg, rgba(237, 163, 51, 0.1), transparent);
    padding: 0.1em 0.3em;
    border-radius: 0.25rem;
    transition: all 0.2s;
  }
  .prose a:hover {
    background: rgba(237, 163, 51, 0.2);
    color: #f5b94d;
  }

  /* Lists with better styling */
  .prose ul,
  .prose ol {
    margin-bottom: 1.75rem;
    padding-left: 0;
    color: #94a3b8;
  }

  .prose ul {
    list-style: none;
  }

  .prose ul li {
    position: relative;
    padding-left: 1.75rem;
    margin-bottom: 0.75rem;
    line-height: 1.7;
  }

  .prose ul li::before {
    content: '';
    position: absolute;
    left: 0;
    top: 0.6em;
    width: 6px;
    height: 6px;
    border-radius: 50%;
    background: linear-gradient(135deg, #EDA333, #4DA6FF);
  }

  .prose ol {
    list-style: none;
    counter-reset: ol-counter;
  }

  .prose ol li {
    position: relative;
    padding-left: 2.5rem;
    margin-bottom: 0.75rem;
    counter-increment: ol-counter;
    line-height: 1.7;
  }

  .prose ol li::before {
    content: counter(ol-counter);
    position: absolute;
    left: 0;
    top: 0;
    width: 1.75rem;
    height: 1.75rem;
    background: linear-gradient(135deg, rgba(237, 163, 51, 0.2), rgba(77, 166, 255, 0.1));
    border: 1px solid rgba(237, 163, 51, 0.3);
    border-radius: 0.5rem;
    font-size: 0.75rem;
    font-weight: 700;
    color: #EDA333;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  /* Nested lists */
  .prose ul ul,
  .prose ol ol,
  .prose ul ol,
  .prose ol ul {
    margin-top: 0.75rem;
    margin-bottom: 0;
  }

  /* Task lists (checkboxes) */
  .prose ul:has(input[type="checkbox"]) {
    list-style: none;
    padding-left: 0;
  }

  .prose ul li:has(input[type="checkbox"]) {
    padding-left: 0;
    display: flex;
    align-items: flex-start;
    gap: 0.75rem;
  }

  .prose ul li:has(input[type="checkbox"])::before {
    display: none;
  }

  .prose input[type="checkbox"] {
    appearance: none;
    width: 1.25rem;
    height: 1.25rem;
    border: 2px solid #2A3B4C;
    border-radius: 0.375rem;
    background: #0F1623;
    cursor: pointer;
    flex-shrink: 0;
    margin-top: 0.2rem;
    transition: all 0.2s;
  }

  .prose input[type="checkbox"]:checked {
    background: linear-gradient(135deg, #4DA6FF, #EDA333);
    border-color: transparent;
  }

  .prose input[type="checkbox"]:checked::after {
    content: '✓';
    display: block;
    text-align: center;
    color: white;
    font-size: 0.75rem;
    font-weight: bold;
    line-height: 1.1rem;
  }

  /* Code Blocks - Enhanced */
  .prose pre {
    background: linear-gradient(180deg, #0a0e17 0%, #0f1623 100%) !important;
    border: 1px solid #1e293b;
    border-radius: 1rem;
    padding: 1.5rem;
    margin: 2rem 0;
    overflow-x: auto;
    position: relative;
  }

  .prose pre::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(90deg, #4DA6FF, #EDA333, #4DA6FF);
    border-radius: 1rem 1rem 0 0;
  }

  .prose code {
    font-family: 'JetBrains Mono', 'Fira Code', monospace;
    font-size: 0.9em;
  }
  
  .prose :not(pre) > code {
    background: rgba(237, 163, 51, 0.1);
    color: #eda333;
    padding: 0.2em 0.5em;
    border-radius: 0.375rem;
    font-size: 0.875em;
    border: 1px solid rgba(237, 163, 51, 0.2);
  }

  /* Blockquotes - Premium style */
  .prose blockquote {
    border-left: none;
    background: linear-gradient(135deg, rgba(77, 166, 255, 0.08), rgba(237, 163, 51, 0.05));
    padding: 1.5rem 2rem;
    border-radius: 1rem;
    font-style: normal;
    color: #d1d9e3;
    margin: 2rem 0;
    position: relative;
    border: 1px solid rgba(77, 166, 255, 0.15);
  }

  .prose blockquote::before {
    content: '"';
    position: absolute;
    top: -0.5rem;
    left: 1.5rem;
    font-size: 4rem;
    color: rgba(77, 166, 255, 0.3);
    font-family: Georgia, serif;
    line-height: 1;
  }

  .prose blockquote p {
    color: #d1d9e3;
    font-size: 1.0625rem;
    margin-bottom: 0;
    position: relative;
    z-index: 1;
  }

  .prose blockquote p:last-child {
    margin-bottom: 0;
  }

  /* Tables - Modern design */
  .prose table {
    width: 100%;
    border-collapse: separate;
    border-spacing: 0;
    margin: 2rem 0;
    overflow: hidden;
    border-radius: 1rem;
    border: 1px solid #2A3B4C;
  }

  .prose thead {
    background: linear-gradient(180deg, #151D2C 0%, #0F1623 100%);
  }

  .prose th {
    padding: 1rem 1.25rem;
    text-align: left;
    font-weight: 600;
    color: #EDA333;
    font-size: 0.875rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    border-bottom: 2px solid #2A3B4C;
  }

  .prose td {
    padding: 1rem 1.25rem;
    color: #94a3b8;
    font-size: 0.9375rem;
    border-bottom: 1px solid rgba(42, 59, 76, 0.5);
  }

  .prose tbody tr {
    background: rgba(15, 22, 35, 0.5);
    transition: background 0.2s;
  }

  .prose tbody tr:hover {
    background: rgba(77, 166, 255, 0.05);
  }

  .prose tbody tr:last-child td {
    border-bottom: none;
  }

  /* Horizontal rules */
  .prose hr {
    border: none;
    height: 1px;
    background: linear-gradient(90deg, transparent, #2A3B4C, #EDA333, #2A3B4C, transparent);
    margin: 3rem 0;
  }

  /* Lead paragraph */
  .prose .lead {
    font-size: 1.25rem;
    line-height: 1.7;
    color: #d1d9e3;
    font-weight: 400;
    margin-bottom: 2.5rem;
    padding: 1.5rem;
    background: linear-gradient(135deg, rgba(237, 163, 51, 0.05), transparent);
    border-left: 3px solid #EDA333;
    border-radius: 0 1rem 1rem 0;
  }

  /* Images */
  .prose img {
    border-radius: 1rem;
    border: 1px solid #2A3B4C;
    margin: 2rem auto;
  }

  /* TOC Active state */
  .toc-link.active {
    background: rgba(237, 163, 51, 0.1);
    border-color: rgba(237, 163, 51, 0.3);
    color: #EDA333 !important;
  }

  .toc-link.active .toc-dot {
    background: #EDA333;
  }

  /* Line clamp utility */
  .line-clamp-1 {
    display: -webkit-box;
    -webkit-line-clamp: 1;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  /* Mobile TOC Active state */
  .mobile-toc-link.active {
    background: rgba(237, 163, 51, 0.15);
    border-color: rgba(237, 163, 51, 0.3);
    color: #EDA333 !important;
  }

  .mobile-toc-link.active .mobile-toc-dot {
    background: #EDA333;
  }

  /* Mobile TOC panel open state */
  #mobile-toc-panel.open {
    opacity: 1;
    transform: scale(1);
    pointer-events: auto;
  }

  /* Mobile TOC toggle button when open */
  #mobile-toc-toggle.open #toc-icon-list {
    opacity: 0;
    transform: scale(0.75) rotate(90deg);
  }

  #mobile-toc-toggle.open #toc-icon-close {
    opacity: 1;
    transform: scale(1) rotate(0deg);
  }
</style>

<style is:global>
  /* Force article content to fill the container */
  #article-content {
    max-width: 100% !important;
    width: 100%;
  }
  
  /* Ensure paragraphs and other elements fill the width */
  #article-content > * {
    max-width: 100% !important;
  }
  
  /* Specifically target paragraphs to ensure they don't have a constrained width */
  #article-content p {
    max-width: 100% !important;
  }
</style>

<script>
  // Reading progress indicator
  const progressBar = document.getElementById('reading-progress');
  const articleContent = document.getElementById('article-content');
  
  if (progressBar && articleContent) {
    window.addEventListener('scroll', () => {
      const articleRect = articleContent.getBoundingClientRect();
      const articleTop = articleRect.top + window.scrollY;
      const articleHeight = articleContent.offsetHeight;
      const windowHeight = window.innerHeight;
      const scrollY = window.scrollY;
      
      const progress = Math.min(
        Math.max((scrollY - articleTop + windowHeight * 0.3) / articleHeight * 100, 0),
        100
      );
      
      progressBar.style.width = `${progress}%`;
    });
  }

  // TOC active state
  const tocLinks = document.querySelectorAll('.toc-link');
  const headings = document.querySelectorAll('.prose h2, .prose h3');
  
  if (tocLinks.length && headings.length) {
    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            const id = entry.target.getAttribute('id');
            tocLinks.forEach((link) => {
              if (link.getAttribute('data-heading') === id) {
                link.classList.add('active');
                
                // Auto-scroll TOC to keep active link in view
                const tocNav = document.getElementById('toc-nav');
                if (tocNav) {
                  const linkEl = link as HTMLElement;
                  const navRect = tocNav.getBoundingClientRect();
                  const linkRect = linkEl.getBoundingClientRect();
                  
                  // Check if link is out of view or close to edges
                  if (linkRect.top < navRect.top + 40 || linkRect.bottom > navRect.bottom - 40) {
                    // Calculate position to scroll to (center the link)
                    const relativeTop = linkRect.top - navRect.top;
                    const currentScroll = tocNav.scrollTop;
                    const targetScroll = currentScroll + relativeTop - (tocNav.offsetHeight / 2) + (linkEl.offsetHeight / 2);
                    
                    tocNav.scrollTo({
                      top: targetScroll,
                      behavior: 'smooth'
                    });
                  }
                }
              } else {
                link.classList.remove('active');
              }
            });
          }
        });
      },
      { rootMargin: '-100px 0px -70% 0px' }
    );

    headings.forEach((heading) => observer.observe(heading));
  }




  // Desktop TOC collapse/expand functionality
  const desktopTocToggle = document.getElementById('desktop-toc-toggle');
  const tocNav = document.getElementById('toc-nav');
  const tocCollapseIcon = document.getElementById('toc-collapse-icon');
  
  if (desktopTocToggle && tocNav && tocCollapseIcon) {
    let isTocCollapsed = false;
    
    desktopTocToggle.addEventListener('click', () => {
      isTocCollapsed = !isTocCollapsed;
      
      if (isTocCollapsed) {
        tocNav.style.maxHeight = '0';
        tocNav.style.opacity = '0';
        tocNav.style.marginTop = '-1rem';
        tocCollapseIcon.style.transform = 'rotate(180deg)';
        desktopTocToggle.title = 'Expand table of contents';
      } else {
        tocNav.style.maxHeight = '500px';
        tocNav.style.opacity = '1';
        tocNav.style.marginTop = '0';
        tocCollapseIcon.style.transform = 'rotate(0deg)';
        desktopTocToggle.title = 'Collapse table of contents';
      }
    });
    
    // Set initial state
    tocNav.style.maxHeight = '500px';
    tocNav.style.opacity = '1';
  }

  // Share buttons functionality
  const shareUrl = window.location.href;
  const shareTitle = document.title;

  document.getElementById('share-twitter')?.addEventListener('click', () => {
    window.open(`https://twitter.com/intent/tweet?url=${encodeURIComponent(shareUrl)}&text=${encodeURIComponent(shareTitle)}`, '_blank');
  });

  document.getElementById('share-facebook')?.addEventListener('click', () => {
    window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(shareUrl)}`, '_blank');
  });

  document.getElementById('share-discord')?.addEventListener('click', () => {
    navigator.clipboard.writeText(shareUrl).then(() => {
      alert('Link copied! Share it on Discord.');
    });
  });

  document.getElementById('share-whatsapp')?.addEventListener('click', () => {
    window.open(`https://wa.me/?text=${encodeURIComponent(shareTitle + ' ' + shareUrl)}`, '_blank');
  });

  document.getElementById('copy-link')?.addEventListener('click', () => {
    navigator.clipboard.writeText(shareUrl).then(() => {
      const btn = document.getElementById('copy-link');
      if (btn) {
        btn.classList.add('text-[#EDA333]');
        setTimeout(() => btn.classList.remove('text-[#EDA333]'), 2000);
      }
    });
  });

  // Mobile TOC toggle functionality
  const mobileTocToggle = document.getElementById('mobile-toc-toggle');
  const mobileTocPanel = document.getElementById('mobile-toc-panel');
  const mobileTocLinks = document.querySelectorAll('.mobile-toc-link');

  if (mobileTocToggle && mobileTocPanel) {
    // Toggle panel
    mobileTocToggle.addEventListener('click', () => {
      const isOpen = mobileTocPanel.classList.contains('open');
      mobileTocPanel.classList.toggle('open');
      mobileTocToggle.classList.toggle('open');
      mobileTocToggle.setAttribute('aria-expanded', (!isOpen).toString());
    });

    // Close when clicking a link
    mobileTocLinks.forEach((link) => {
      link.addEventListener('click', () => {
        mobileTocPanel.classList.remove('open');
        mobileTocToggle.classList.remove('open');
        mobileTocToggle.setAttribute('aria-expanded', 'false');
      });
    });

    // Close when clicking outside
    document.addEventListener('click', (e) => {
      const target = e.target as HTMLElement;
      if (!target.closest('#mobile-toc-container')) {
        mobileTocPanel.classList.remove('open');
        mobileTocToggle.classList.remove('open');
        mobileTocToggle.setAttribute('aria-expanded', 'false');
      }
    });

    // Update active state for mobile TOC
    if (headings.length) {
      const mobileObserver = new IntersectionObserver(
        (entries) => {
          entries.forEach((entry) => {
            if (entry.isIntersecting) {
              const id = entry.target.getAttribute('id');
              mobileTocLinks.forEach((link) => {
                if (link.getAttribute('data-heading') === id) {
                  link.classList.add('active');
                } else {
                  link.classList.remove('active');
                }
              });
            }
          });
        },
        { rootMargin: '-100px 0px -70% 0px' }
      );

      headings.forEach((heading) => mobileObserver.observe(heading));
    }
  }
</script>
